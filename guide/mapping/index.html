<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../../genindex/" /><link rel="search" title="Search" href="../../search/" /><link rel="next" title="Configuration" href="../configuration/" /><link rel="prev" title="Tutorial" href="../tutorial/" />

    <meta name="generator" content="sphinx-5.1.1, furo 2022.06.21"/>
        <title>Mapping over Inputs - gwf 1.8.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=40978830699223671f4072448e654b5958f38b89" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f0f0f0;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../"><div class="brand">gwf 1.8.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../">
  
  
  <span class="sidebar-brand-text">gwf 1.8.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search/" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../">User’s Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../installation/">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/">Tutorial</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Mapping over Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../patterns/">Tips and Tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/">Plugins</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../development/">How to Contribute</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/writingbackends/">Writing Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/forcontributors/">For Contributors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/formaintainers/">For Maintainers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/">Change Log</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/backends/">Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/api/">API</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="mapping-over-inputs">
<span id="using-map"></span><h1>Mapping over Inputs<a class="headerlink" href="#mapping-over-inputs" title="Permalink to this heading">#</a></h1>
<p>Assume that we have a list of inputs and we wish to create a new target for
every input in the list. We can solve this by writing a <em>template function</em> and
then a for-loop to iterate over our list of inputs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gwf</span> <span class="kn">import</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">AnonymousTarget</span>

<span class="n">gwf</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">transform_photo</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.new&#39;</span><span class="p">]</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;./transform_photo </span><span class="si">{}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">AnonymousTarget</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">)</span>

<span class="n">photos</span> <span class="o">=</span> <span class="n">gwf</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;photos/*.jpg&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">photos</span><span class="p">):</span>
    <span class="n">gwf</span><span class="o">.</span><span class="n">target_from_template</span><span class="p">(</span><span class="s1">&#39;TransformPhoto.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">transform_photo</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</pre></div>
</div>
<p>While this is pretty clean, it can become unwieldy and the extra layer of
indentation makes the workflow a bit harder to read.</p>
<p>In <em>gwf</em> 1.6 we introduced <em>named</em> inputs and outputs. This means that we can
assign names to the paths that a target/template takes as inputs and outputs.
Let’s rewrite our template to make use of this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">transform_photo</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">}</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.new&#39;</span><span class="p">}</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;./transform_photo </span><span class="si">{}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">AnonymousTarget</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">)</span>
</pre></div>
</div>
<p>From <em>gwf</em> 1.6 and up you can use the new <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#map" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">map()</span></code></a> method on your workflow
to get rid of the explicit iteration in the first example. This is what the
example would look like with <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#map" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">map()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gwf</span> <span class="kn">import</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">AnonymousTarget</span>

<span class="n">gwf</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">transform_photo</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">}</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.new&#39;</span><span class="p">}</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;./transform_photo </span><span class="si">{}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">AnonymousTarget</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">)</span>

<span class="n">photos</span> <span class="o">=</span> <span class="n">gwf</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;photos/*.jpg&#39;</span><span class="p">)</span>
<span class="n">gwf</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transform_photo</span><span class="p">,</span> <span class="n">photos</span><span class="p">)</span>
</pre></div>
</div>
<p>Our for-loop is now gone and has been replaced with a call to <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#map" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">map()</span></code></a>.
This will iterate through our list of photos, call the template function with
each path, and add the resulting targets to our workflow.</p>
<p>If we run <code class="docutils literal notranslate"><span class="pre">gwf</span> <span class="pre">status</span></code> we see this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>transform_photo_0    shouldrun       0.00% [1/0/0/0]
transform_photo_1    shouldrun       0.00% [1/0/0/0]
transform_photo_2    shouldrun       0.00% [1/0/0/0]
</pre></div>
</div>
<p>Since I had three photos, three targets have been generated. The name of the
target is automatically derived from the name of the template function and an
index.</p>
<section id="naming-targets-differently">
<h2>Naming Targets Differently<a class="headerlink" href="#naming-targets-differently" title="Permalink to this heading">#</a></h2>
<p>That’s useful, but what if you don’t like the generated target names? If you’re
fine with the automatic numbering, but want to use another name than the
template function name, you can set the <code class="docutils literal notranslate"><span class="pre">name</span></code> argument to a string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gwf</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transform_photo</span><span class="p">,</span> <span class="n">photos</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;TransformPhoto&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s see what we get then:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>TransformPhoto_0    shouldrun       0.00% [1/0/0/0]
TransformPhoto_1    shouldrun       0.00% [1/0/0/0]
TransformPhoto_2    shouldrun       0.00% [1/0/0/0]
</pre></div>
</div>
<p>You can also completely customize how the name is generated by giving
<a class="reference external" href="https://docs.python.org/3.7/library/functions.html#map" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">map()</span></code></a> a naming function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span>

<span class="k">def</span> <span class="nf">get_photo_name</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="s1">&#39;transform_photo_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="n">gwf</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transform_photo</span><span class="p">,</span> <span class="n">photos</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">get_photo_name</span><span class="p">)</span>
</pre></div>
</div>
<p>This is what we get:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>transform_photo_dog      shouldrun       0.00% [1/0/0/0]
transform_photo_horse    shouldrun       0.00% [1/0/0/0]
transform_photo_cat      shouldrun       0.00% [1/0/0/0]
</pre></div>
</div>
<p>Pretty and descriptive!</p>
</section>
<section id="passing-multiple-arguments-to-a-template-function">
<h2>Passing Multiple Arguments to a Template Function<a class="headerlink" href="#passing-multiple-arguments-to-a-template-function" title="Permalink to this heading">#</a></h2>
<p>What if our template took multiple arguments? Let’s modify our template function
a bit:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">transform_photo</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">}</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.new&#39;</span><span class="p">}</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;./transform_photo --width </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">AnonymousTarget</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">)</span>
</pre></div>
</div>
<p>To set the <code class="docutils literal notranslate"><span class="pre">width</span></code> argument to <code class="docutils literal notranslate"><span class="pre">800</span></code> for all targets generated by
<a class="reference external" href="https://docs.python.org/3.7/library/functions.html#map" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">map()</span></code></a> we do this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gwf</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transform_photo</span><span class="p">,</span> <span class="n">photos</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">get_photo_name</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">800</span><span class="p">})</span>
</pre></div>
</div>
<p>But what if the width depends on the image? If <code class="docutils literal notranslate"><span class="pre">photos</span></code> is a list of
dictionaries, <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#map" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">map()</span></code></a> will pass the contents of each dictionary as keyword
arguments to the function template:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">photos</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;photos/dog.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">600</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;photos/horse.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;photos/cat.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">gwf</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transform_photo</span><span class="p">,</span> <span class="n">photos</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">get_photo_name</span><span class="p">)</span>
</pre></div>
</div>
<p>These two approaches can be combined, so you can pass a list of dictionaries as
the inputs and set arguments with <code class="docutils literal notranslate"><span class="pre">extra</span></code> as well.</p>
</section>
<section id="chaining-maps">
<h2>Chaining Maps<a class="headerlink" href="#chaining-maps" title="Permalink to this heading">#</a></h2>
<p>You may wonder what <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#map" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">map()</span></code></a> actually returns. Let’s take a look:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">transformed_photos</span> <span class="o">=</span> <span class="n">gwf</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transform_photo</span><span class="p">,</span> <span class="n">photos</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">get_photo_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">transformed_photos</span><span class="p">))</span>
<span class="c1"># =&gt; TargetList(targets=[Target(name=&#39;transform_photo_dog&#39;, ...), ...])</span>
</pre></div>
</div>
<p>We get something called a <a class="reference internal" href="../../reference/api/#gwf.TargetList" title="gwf.TargetList"><code class="xref py py-class docutils literal notranslate"><span class="pre">gwf.TargetList</span></code></a> back! This is a simple wrapper
around a normal list, but it allows us to access all of the inputs and outputs
of the targets contained in the <code class="xref py py-class docutils literal notranslate"><span class="pre">TargetList</span></code> through <code class="xref py py-attr docutils literal notranslate"><span class="pre">inputs</span></code> and
<code class="xref py py-attr docutils literal notranslate"><span class="pre">outputs</span></code>, respectively. Both of these return a list of the inputs/outputs
of the targets. Thus, if your template function uses named outputs,
<code class="xref py py-attr docutils literal notranslate"><span class="pre">outputs</span></code> will be a list of dictionaries.</p>
<p>How is this useful? If we wanted to use another template on each transformed
photo, we can just map over the outputs of the <code class="xref py py-class docutils literal notranslate"><span class="pre">TargetList</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">transformed_photos</span> <span class="o">=</span> <span class="n">gwf</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transform_photo</span><span class="p">,</span> <span class="n">photos</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">get_photo_name</span><span class="p">)</span>
<span class="n">compressed_photos</span> <span class="o">=</span> <span class="n">gwf</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">compress_photo</span><span class="p">,</span> <span class="n">transformed_photos</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
</pre></div>
</div>
<p>We could keep on going like this!</p>
</section>
<section id="collecting-files">
<h2>Collecting Files<a class="headerlink" href="#collecting-files" title="Permalink to this heading">#</a></h2>
<p>Now that you’ve transformed and compressed your photos, you may also want to
zip them into a single file. For this you wrote a template that looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">zip_files</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">output_path</span><span class="p">):</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;paths&#39;</span><span class="p">:</span> <span class="n">paths</span><span class="p">}</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;zipped_file&#39;</span><span class="p">:</span> <span class="n">output_path</span><span class="p">}</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;zip ...&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">AnonymousTarget</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">)</span>
</pre></div>
</div>
<p>Your template accepts two arguments: a list of files to zip and where to put
the resulting file. We can’t use <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#map" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">map()</span></code></a> because we don’t want a zip file
per photo, but a single target that depends on all of the photo files.</p>
<p>We start out by writing our call to <code class="xref py py-func docutils literal notranslate"><span class="pre">target_from_template()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">transformed_photos</span> <span class="o">=</span> <span class="n">gwf</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transform_photo</span><span class="p">,</span> <span class="n">photos</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">get_photo_name</span><span class="p">)</span>
<span class="n">compressed_photos</span> <span class="o">=</span> <span class="n">gwf</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">compress_photo</span><span class="p">,</span> <span class="n">transformed_photos</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
<span class="n">gwf</span><span class="o">.</span><span class="n">target_from_template</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;zip_photos&#39;</span><span class="p">,</span>
    <span class="n">zip_files</span><span class="p">(</span>
        <span class="n">paths</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">],</span>
        <span class="n">output_path</span><span class="o">=</span><span class="s2">&quot;photos.zip&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>How do we get the list of paths? We can use the <code class="xref py py-func docutils literal notranslate"><span class="pre">collect()</span></code> helper
function!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gwf.workflow</span> <span class="kn">import</span> <span class="n">collect</span>

<span class="n">transformed_photos</span> <span class="o">=</span> <span class="n">gwf</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transform_photo</span><span class="p">,</span> <span class="n">photos</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">get_photo_name</span><span class="p">)</span>
<span class="n">compressed_photos</span> <span class="o">=</span> <span class="n">gwf</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">compress_photo</span><span class="p">,</span> <span class="n">transformed_photos</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
<span class="n">gwf</span><span class="o">.</span><span class="n">target_from_template</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;zip_photos&#39;</span><span class="p">,</span>
    <span class="n">zip_files</span><span class="p">(</span>
        <span class="n">paths</span><span class="o">=</span><span class="n">collect</span><span class="p">(</span><span class="n">compress_photos</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]),</span>
        <span class="n">output_path</span><span class="o">=</span><span class="s2">&quot;photos.zip&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <code class="xref py py-func docutils literal notranslate"><span class="pre">collect()</span></code> function takes a list of dictionaries and produces a
single dictionary containing a list for each key. So when given this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;photos/dog.jpg.new&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;photos/horse.jpg.new&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;photos/cat.jpg.new&#39;</span><span class="p">},</span>
<span class="p">]</span>
</pre></div>
</div>
<p>it simply produces this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;paths&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;photos/dog.jpg.new&#39;</span><span class="p">,</span> <span class="s1">&#39;photos/horse.jpg.new&#39;</span><span class="p">,</span> <span class="s1">&#39;photos/cat.jpg.new&#39;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that the name <cite>path</cite> has been pluralized, so it’s now <cite>paths</cite> in the
dictionary. We can pass this directly to our <code class="docutils literal notranslate"><span class="pre">zip_files</span></code> template:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gwf.workflow</span> <span class="kn">import</span> <span class="n">collect</span>

<span class="n">transformed_photos</span> <span class="o">=</span> <span class="n">gwf</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transform_photo</span><span class="p">,</span> <span class="n">photos</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">get_photo_name</span><span class="p">)</span>
<span class="n">compressed_photos</span> <span class="o">=</span> <span class="n">gwf</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">compress_photo</span><span class="p">,</span> <span class="n">transformed_photos</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
<span class="n">gwf</span><span class="o">.</span><span class="n">target_from_template</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;zip_photos&#39;</span><span class="p">,</span>
    <span class="n">zip_files</span><span class="p">(</span>
        <span class="n">paths</span><span class="o">=**</span><span class="n">collect</span><span class="p">(</span><span class="n">compress_photos</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]),</span>
        <span class="n">output_path</span><span class="o">=</span><span class="s2">&quot;photos.zip&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We use Python’s double-star operator to pass a dictionary as keyword arguments
to a function.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../configuration/">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Configuration</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../tutorial/">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Tutorial</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2019, Dan Søndergaard
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Mapping over Inputs</a><ul>
<li><a class="reference internal" href="#naming-targets-differently">Naming Targets Differently</a></li>
<li><a class="reference internal" href="#passing-multiple-arguments-to-a-template-function">Passing Multiple Arguments to a Template Function</a></li>
<li><a class="reference internal" href="#chaining-maps">Chaining Maps</a></li>
<li><a class="reference internal" href="#collecting-files">Collecting Files</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    </body>
</html>